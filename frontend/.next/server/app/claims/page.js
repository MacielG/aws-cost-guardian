(()=>{var e={};e.id=853,e.ids=[853],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},2491:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>o});var a=t(7096),r=t(6132),i=t(7284),n=t.n(i),l=t(2564),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let o=["",{children:["claims",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,6259)),"C:\\Users\\Guilherme\\Documents\\Github\\aws-cost-guardian\\frontend\\app\\claims\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4943)),"C:\\Users\\Guilherme\\Documents\\Github\\aws-cost-guardian\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,4293)),"C:\\Users\\Guilherme\\Documents\\Github\\aws-cost-guardian\\frontend\\app\\not-found.tsx"]}],d=["C:\\Users\\Guilherme\\Documents\\Github\\aws-cost-guardian\\frontend\\app\\claims\\page.tsx"],u="/claims/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/claims/page",pathname:"/claims",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4243:(e,s,t)=>{Promise.resolve().then(t.bind(t,3940))},3940:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>AdminClaims});var a=t(784),r=t(7870),i=t(599),n=t(5555),l=t(644),c=t(5574),o=t(5688),d=t(9885),u=t(1890);let Input=e=>a.jsx("input",{...e,className:`border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ${e.className||""}`}),m=(0,d.createContext)({}),Select=({children:e,value:s,onValueChange:t})=>{let[r,i]=(0,d.useState)(!1);return a.jsx(m.Provider,{value:{value:s,onValueChange:t,open:r,setOpen:i},children:a.jsx("div",{className:"relative inline-block",children:e})})},SelectTrigger=({children:e,className:s=""})=>{let t=(0,d.useContext)(m);return a.jsx("button",{type:"button",onClick:()=>t.setOpen&&t.setOpen(!t.open),className:`border rounded px-3 py-2 text-sm flex items-center justify-between ${s}`,children:e})},SelectValue=({placeholder:e})=>{let s=(0,d.useContext)(m);return a.jsx("span",{children:s.value||e})},SelectContent=({children:e})=>{let s=(0,d.useContext)(m);return s.open?a.jsx("div",{className:"absolute z-10 mt-2 w-56 bg-white border rounded shadow-md",children:e}):null},SelectItem=({children:e,value:s})=>{let t=(0,d.useContext)(m);return a.jsx("div",{onClick:()=>{t.onValueChange&&t.onValueChange(s),t.setOpen&&t.setOpen(!1)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:e})};SelectTrigger.displayName="SelectTrigger",SelectContent.displayName="SelectContent",SelectItem.displayName="SelectItem",SelectValue.displayName="SelectValue";var p=t(9941);let getStatusVariant=e=>{switch(e){case"PAID":case"REFUNDED":return"success";case"SUBMITTED":default:return"default";case"READY_TO_SUBMIT":return"secondary";case"SUBMISSION_FAILED":case"REPORT_FAILED":return"destructive";case"NO_VIOLATION":case"NO_RESOURCES_LISTED":return"outline"}},x=["ALL","READY_TO_SUBMIT","SUBMITTED","SUBMISSION_FAILED","PAID","REFUNDED","NO_VIOLATION","NO_RESOURCES_LISTED","REPORT_FAILED"];function AdminClaims(){let{t:e}=(0,r.$G)(),[s,t]=(0,d.useState)([]),[m,h]=(0,d.useState)([]),[g,f]=(0,d.useState)(!0),[C,j]=(0,d.useState)(null),[S,I]=(0,d.useState)("ALL"),[v,A]=(0,d.useState)(""),E=(0,d.useCallback)(async()=>{f(!0),j(null);try{let e=await fetch("/api/admin/claims");if(!e.ok)throw Error("Failed to fetch admin claims");let s=await e.json();t(s),h(s)}catch(e){j(e instanceof Error?e.message:"An unknown error occurred")}finally{f(!1)}},[]);(0,d.useEffect)(()=>{E()},[E]),(0,d.useEffect)(()=>{let e=s;if("ALL"!==S&&(e=e.filter(e=>e.status===S)),v){let s=v.toLowerCase();e=e.filter(e=>e.sk.toLowerCase().includes(s)||e.incidentId.toLowerCase().includes(s)||e.awsAccountId.toLowerCase().includes(s)||e.id.toLowerCase().includes(s))}h(e)},[s,S,v]);let handleUpdateClaimStatus=async(e,s,t)=>{if(confirm(`Tem certeza que deseja mudar o status da reivindica\xe7\xe3o ${s.replace("CLAIM#","")} para ${t}?`))try{let a=await fetch(`/api/admin/claims/${e}/${s.replace("CLAIM#","")}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to update claim status")}p.Am.success(`Status da reivindica\xe7\xe3o ${s.replace("CLAIM#","")} atualizado para ${t}.`),E()}catch(e){p.Am.error(`Erro ao atualizar status: ${e instanceof Error?e.message:"Erro desconhecido"}`)}};return a.jsx("div",{className:"p-8",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[a.jsx(i.ll,{children:e("adminClaims.title","Gerenciamento de Reivindica\xe7\xf5es (Admin)")}),a.jsx(i.SZ,{children:e("adminClaims.description","Visualize e gerencie todas as reivindica\xe7\xf5es de cr\xe9dito SLA do sistema.")})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[a.jsx(Input,{placeholder:e("adminClaims.searchPlaceholder","Buscar por ID, incidente, conta AWS..."),value:v,onChange:e=>A(e.target.value),className:"flex-grow"}),(0,a.jsxs)(Select,{value:S,onValueChange:I,children:[a.jsx(SelectTrigger,{className:"w-[180px]",children:a.jsx(SelectValue,{placeholder:e("adminClaims.filterByStatus","Filtrar por Status")})}),a.jsx(SelectContent,{children:x.map(s=>a.jsx(SelectItem,{value:s,children:e(`statuses.${s}`,s.replace(/_/g," "))},s))})]}),a.jsx(n.z,{onClick:E,variant:"outline",size:"icon",children:a.jsx(l.Z,{className:"h-4 w-4"})})]}),g&&a.jsx("p",{children:e("loading","Carregando...")}),C&&(0,a.jsxs)("p",{className:"text-red-500",children:[e("error","Erro"),": ",C]}),!g&&!C&&0===m.length&&a.jsx("p",{children:e("adminClaims.noClaims","Nenhuma reivindica\xe7\xe3o encontrada com os filtros aplicados.")}),!g&&!C&&m.length>0&&a.jsx("div",{className:"space-y-4",children:m.map(s=>a.jsx(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:[e("adminClaims.claimId","Reivindica\xe7\xe3o ID"),": ",s.sk.replace("CLAIM#","")]}),a.jsx(u.C,{variant:getStatusVariant(s.status),children:e(`statuses.${s.status}`,s.status)})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e("adminClaims.customerId","Cliente ID"),": ",s.id]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e("adminClaims.incidentId","Incidente Associado"),": ",s.incidentId.replace("INCIDENT#","")]}),(0,a.jsxs)("p",{className:"mt-2",children:[e("adminClaims.awsAccount","Conta AWS"),": ",s.awsAccountId]}),(0,a.jsxs)("p",{children:[e("adminClaims.estimatedCredit","Cr\xe9dito Estimado"),": ",(0,a.jsxs)("span",{className:"font-medium",children:["$",s.creditAmount?.toFixed(2)||"0.00"]})]}),s.commissionAmount&&(0,a.jsxs)("p",{children:[e("adminClaims.commissionPaid","Comiss\xe3o Paga"),": ",(0,a.jsxs)("span",{className:"font-medium",children:["$",s.commissionAmount.toFixed(2)]})]}),s.caseId&&(0,a.jsxs)("p",{children:[e("adminClaims.supportCaseId","ID do Caso de Suporte AWS"),": ",a.jsx("span",{className:"font-medium",children:s.caseId})]}),s.stripeInvoiceId&&(0,a.jsxs)("p",{children:[e("adminClaims.stripeInvoiceId","ID da Fatura Stripe"),": ",a.jsx("span",{className:"font-medium",children:s.stripeInvoiceId})]}),s.submissionError&&(0,a.jsxs)("p",{className:"text-red-500",children:[e("adminClaims.submissionError","Erro no Envio"),": ",s.submissionError]}),(0,a.jsxs)("div",{className:"mt-4 space-x-2 flex flex-wrap gap-2",children:[s.reportUrl&&a.jsx(n.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:s.reportUrl,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(c.Z,{className:"mr-2 h-4 w-4"})," ",e("adminClaims.downloadReport","Baixar Relat\xf3rio")]})}),s.caseId&&a.jsx(n.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:`https://console.aws.amazon.com/support/cases/#/case/${s.caseId}`,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(o.Z,{className:"mr-2 h-4 w-4"})," ",e("adminClaims.viewSupportCase","Ver Caso de Suporte")]})}),"READY_TO_SUBMIT"===s.status&&a.jsx(n.z,{variant:"secondary",size:"sm",onClick:()=>handleMarkAsRefunded(s.id,s.sk),children:e("adminClaims.markAsRefundedAndInvoice","Marcar como Reembolsado (Gerar Fatura)")}),(0,a.jsxs)(Select,{value:s.status,onValueChange:e=>handleUpdateClaimStatus(s.id,s.sk,e),children:[a.jsx(SelectTrigger,{className:"w-[200px]",children:a.jsx(SelectValue,{placeholder:e("adminClaims.changeStatus","Mudar Status (Emerg\xeancia)")})}),a.jsx(SelectContent,{children:x.filter(e=>"ALL"!==e).map(s=>a.jsx(SelectItem,{value:s,children:e(`statuses.${s}`,s.replace(/_/g," "))},s))})]})]})]})},s.sk))})]})]})})}let handleMarkAsRefunded=async(e,s)=>{let t=s.replace("CLAIM#","");if(confirm(`Isso marcar\xe1 a claim ${t} como REEMBOLSADA e GERAR\xc1 A FATURA de comiss\xe3o para o cliente. Continuar?`))try{let s=await fetch(`/api/admin/claims/${e}/${t}/create-invoice`,{method:"POST"});if(!s.ok){let e=await s.json();throw Error(e.message||"Falha ao criar fatura")}let a=await s.json();p.Am.success(`Fatura ${a.invoiceId} criada! Claim marcada como REFUNDED.`),fetchClaims()}catch(e){p.Am.error(`Erro: ${e instanceof Error?e.message:"Erro desconhecido"}`)}}},1890:(e,s,t)=>{"use strict";t.d(s,{C:()=>Badge});var a=t(784);function Badge({children:e,variant:s="default"}){return a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-sm font-medium ${{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",destructive:"bg-red-100 text-red-800",secondary:"bg-blue-100 text-blue-800",outline:"border border-gray-300 text-gray-800 bg-white"}[s]}`,children:e})}t(9885)},6259:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>i,default:()=>c});var a=t(5153);let r=(0,a.createProxy)(String.raw`C:\Users\Guilherme\Documents\Github\aws-cost-guardian\frontend\app\claims\page.tsx`),{__esModule:i,$$typeof:n}=r,l=r.default,c=l}};var s=require("../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[98,734,870,528,946,73,924,555,599],()=>__webpack_exec__(2491));module.exports=t})();