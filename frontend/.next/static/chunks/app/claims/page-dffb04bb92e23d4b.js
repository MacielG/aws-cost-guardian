(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{534:function(e,a,t){Promise.resolve().then(t.bind(t,1692))},1692:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return AdminClaims}});var s=t(7821),r=t(6106),n=t(4232),i=t(6169),c=t(2953),l=t(6693),o=t(2789),d=t(8078),u=t(8649);let Input=e=>(0,s.jsx)("input",{...e,className:"border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 ".concat(e.className||"")}),m=(0,d.createContext)({}),Select=e=>{let{children:a,value:t,onValueChange:r}=e,[n,i]=(0,d.useState)(!1);return(0,s.jsx)(m.Provider,{value:{value:t,onValueChange:r,open:n,setOpen:i},children:(0,s.jsx)("div",{className:"relative inline-block",children:a})})},SelectTrigger=e=>{let{children:a,className:t=""}=e,r=(0,d.useContext)(m);return(0,s.jsx)("button",{type:"button",onClick:()=>r.setOpen&&r.setOpen(!r.open),className:"border rounded px-3 py-2 text-sm flex items-center justify-between ".concat(t),children:a})},SelectValue=e=>{let{placeholder:a}=e,t=(0,d.useContext)(m);return(0,s.jsx)("span",{children:t.value||a})},SelectContent=e=>{let{children:a}=e,t=(0,d.useContext)(m);return t.open?(0,s.jsx)("div",{className:"absolute z-10 mt-2 w-56 bg-white border rounded shadow-md",children:a}):null},SelectItem=e=>{let{children:a,value:t}=e,r=(0,d.useContext)(m);return(0,s.jsx)("div",{onClick:()=>{r.onValueChange&&r.onValueChange(t),r.setOpen&&r.setOpen(!1)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:a})};SelectTrigger.displayName="SelectTrigger",SelectContent.displayName="SelectContent",SelectItem.displayName="SelectItem",SelectValue.displayName="SelectValue";var x=t(6055);let getStatusVariant=e=>{switch(e){case"PAID":case"REFUNDED":return"success";case"SUBMITTED":default:return"default";case"READY_TO_SUBMIT":return"secondary";case"SUBMISSION_FAILED":case"REPORT_FAILED":return"destructive";case"NO_VIOLATION":case"NO_RESOURCES_LISTED":return"outline"}},p=["ALL","READY_TO_SUBMIT","SUBMITTED","SUBMISSION_FAILED","PAID","REFUNDED","NO_VIOLATION","NO_RESOURCES_LISTED","REPORT_FAILED"];function AdminClaims(){let{t:e}=(0,r.$G)(),[a,t]=(0,d.useState)([]),[m,f]=(0,d.useState)([]),[h,C]=(0,d.useState)(!0),[g,j]=(0,d.useState)(null),[S,N]=(0,d.useState)("ALL"),[I,v]=(0,d.useState)(""),E=(0,d.useCallback)(async()=>{C(!0),j(null);try{let e=await fetch("/api/admin/claims");if(!e.ok)throw Error("Failed to fetch admin claims");let a=await e.json();t(a),f(a)}catch(e){j(e instanceof Error?e.message:"An unknown error occurred")}finally{C(!1)}},[]);(0,d.useEffect)(()=>{E()},[E]),(0,d.useEffect)(()=>{let e=a;if("ALL"!==S&&(e=e.filter(e=>e.status===S)),I){let a=I.toLowerCase();e=e.filter(e=>e.sk.toLowerCase().includes(a)||e.incidentId.toLowerCase().includes(a)||e.awsAccountId.toLowerCase().includes(a)||e.id.toLowerCase().includes(a))}f(e)},[a,S,I]);let handleUpdateClaimStatus=async(e,a,t)=>{if(confirm("Tem certeza que deseja mudar o status da reivindica\xe7\xe3o ".concat(a.replace("CLAIM#","")," para ").concat(t,"?")))try{let s=await fetch("/api/admin/claims/".concat(e,"/").concat(a.replace("CLAIM#",""),"/status"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to update claim status")}x.Am.success("Status da reivindica\xe7\xe3o ".concat(a.replace("CLAIM#","")," atualizado para ").concat(t,".")),E()}catch(e){x.Am.error("Erro ao atualizar status: ".concat(e instanceof Error?e.message:"Erro desconhecido"))}};return(0,s.jsx)("div",{className:"p-8",children:(0,s.jsxs)(n.Zb,{children:[(0,s.jsxs)(n.Ol,{children:[(0,s.jsx)(n.ll,{children:e("adminClaims.title","Gerenciamento de Reivindica\xe7\xf5es (Admin)")}),(0,s.jsx)(n.SZ,{children:e("adminClaims.description","Visualize e gerencie todas as reivindica\xe7\xf5es de cr\xe9dito SLA do sistema.")})]}),(0,s.jsxs)(n.aY,{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,s.jsx)(Input,{placeholder:e("adminClaims.searchPlaceholder","Buscar por ID, incidente, conta AWS..."),value:I,onChange:e=>v(e.target.value),className:"flex-grow"}),(0,s.jsxs)(Select,{value:S,onValueChange:N,children:[(0,s.jsx)(SelectTrigger,{className:"w-[180px]",children:(0,s.jsx)(SelectValue,{placeholder:e("adminClaims.filterByStatus","Filtrar por Status")})}),(0,s.jsx)(SelectContent,{children:p.map(a=>(0,s.jsx)(SelectItem,{value:a,children:e("statuses.".concat(a),a.replace(/_/g," "))},a))})]}),(0,s.jsx)(i.z,{onClick:E,variant:"outline",size:"icon",children:(0,s.jsx)(c.Z,{className:"h-4 w-4"})})]}),h&&(0,s.jsx)("p",{children:e("loading","Carregando...")}),g&&(0,s.jsxs)("p",{className:"text-red-500",children:[e("error","Erro"),": ",g]}),!h&&!g&&0===m.length&&(0,s.jsx)("p",{children:e("adminClaims.noClaims","Nenhuma reivindica\xe7\xe3o encontrada com os filtros aplicados.")}),!h&&!g&&m.length>0&&(0,s.jsx)("div",{className:"space-y-4",children:m.map(a=>{var t;return(0,s.jsx)(n.Zb,{children:(0,s.jsxs)(n.aY,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:[e("adminClaims.claimId","Reivindica\xe7\xe3o ID"),": ",a.sk.replace("CLAIM#","")]}),(0,s.jsx)(u.C,{variant:getStatusVariant(a.status),children:e("statuses.".concat(a.status),a.status)})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e("adminClaims.customerId","Cliente ID"),": ",a.id]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e("adminClaims.incidentId","Incidente Associado"),": ",a.incidentId.replace("INCIDENT#","")]}),(0,s.jsxs)("p",{className:"mt-2",children:[e("adminClaims.awsAccount","Conta AWS"),": ",a.awsAccountId]}),(0,s.jsxs)("p",{children:[e("adminClaims.estimatedCredit","Cr\xe9dito Estimado"),": ",(0,s.jsxs)("span",{className:"font-medium",children:["$",(null===(t=a.creditAmount)||void 0===t?void 0:t.toFixed(2))||"0.00"]})]}),a.commissionAmount&&(0,s.jsxs)("p",{children:[e("adminClaims.commissionPaid","Comiss\xe3o Paga"),": ",(0,s.jsxs)("span",{className:"font-medium",children:["$",a.commissionAmount.toFixed(2)]})]}),a.caseId&&(0,s.jsxs)("p",{children:[e("adminClaims.supportCaseId","ID do Caso de Suporte AWS"),": ",(0,s.jsx)("span",{className:"font-medium",children:a.caseId})]}),a.stripeInvoiceId&&(0,s.jsxs)("p",{children:[e("adminClaims.stripeInvoiceId","ID da Fatura Stripe"),": ",(0,s.jsx)("span",{className:"font-medium",children:a.stripeInvoiceId})]}),a.submissionError&&(0,s.jsxs)("p",{className:"text-red-500",children:[e("adminClaims.submissionError","Erro no Envio"),": ",a.submissionError]}),(0,s.jsxs)("div",{className:"mt-4 space-x-2 flex flex-wrap gap-2",children:[a.reportUrl&&(0,s.jsx)(i.z,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsxs)("a",{href:a.reportUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)(l.Z,{className:"mr-2 h-4 w-4"})," ",e("adminClaims.downloadReport","Baixar Relat\xf3rio")]})}),a.caseId&&(0,s.jsx)(i.z,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsxs)("a",{href:"https://console.aws.amazon.com/support/cases/#/case/".concat(a.caseId),target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)(o.Z,{className:"mr-2 h-4 w-4"})," ",e("adminClaims.viewSupportCase","Ver Caso de Suporte")]})}),"READY_TO_SUBMIT"===a.status&&(0,s.jsx)(i.z,{variant:"secondary",size:"sm",onClick:()=>handleMarkAsRefunded(a.id,a.sk),children:e("adminClaims.markAsRefundedAndInvoice","Marcar como Reembolsado (Gerar Fatura)")}),(0,s.jsxs)(Select,{value:a.status,onValueChange:e=>handleUpdateClaimStatus(a.id,a.sk,e),children:[(0,s.jsx)(SelectTrigger,{className:"w-[200px]",children:(0,s.jsx)(SelectValue,{placeholder:e("adminClaims.changeStatus","Mudar Status (Emerg\xeancia)")})}),(0,s.jsx)(SelectContent,{children:p.filter(e=>"ALL"!==e).map(a=>(0,s.jsx)(SelectItem,{value:a,children:e("statuses.".concat(a),a.replace(/_/g," "))},a))})]})]})]})},a.sk)})})]})]})})}let handleMarkAsRefunded=async(e,a)=>{let t=a.replace("CLAIM#","");if(confirm("Isso marcar\xe1 a claim ".concat(t," como REEMBOLSADA e GERAR\xc1 A FATURA de comiss\xe3o para o cliente. Continuar?")))try{let a=await fetch("/api/admin/claims/".concat(e,"/").concat(t,"/create-invoice"),{method:"POST"});if(!a.ok){let e=await a.json();throw Error(e.message||"Falha ao criar fatura")}let s=await a.json();x.Am.success("Fatura ".concat(s.invoiceId," criada! Claim marcada como REFUNDED.")),fetchClaims()}catch(e){x.Am.error("Erro: ".concat(e instanceof Error?e.message:"Erro desconhecido"))}}},8649:function(e,a,t){"use strict";t.d(a,{C:function(){return Badge}});var s=t(7821);function Badge(e){let{children:a,variant:t="default"}=e;return(0,s.jsx)("span",{className:"".concat("inline-flex items-center px-2 py-0.5 rounded text-sm font-medium"," ").concat({default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",destructive:"bg-red-100 text-red-800",secondary:"bg-blue-100 text-blue-800",outline:"border border-gray-300 text-gray-800 bg-white"}[t]),children:a})}t(8078)},6169:function(e,a,t){"use strict";t.d(a,{z:function(){return Button}});var s=t(7821),r=t(8078),n=t(9544);function Button(e){let{className:a,variant:t="default",size:i="default",asChild:c=!1,children:l,...o}=e,d=(0,n.cn)("inline-flex items-center justify-center rounded font-medium","outline"===t?"border border-gray-300 bg-white text-gray-800":"secondary"===t?"bg-gray-100 text-gray-800":"bg-blue-500 text-white","sm"===i?"px-3 py-1.5 text-sm":"icon"===i?"p-2 text-sm":"px-4 py-2 text-base",a||"");return c&&l&&(0,r.isValidElement)(l)?r.cloneElement(l,{className:(0,n.cn)(d,l.props.className),...o}):(0,s.jsx)("button",{className:d,...o,children:l})}},4232:function(e,a,t){"use strict";t.d(a,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},ll:function(){return l}});var s=t(7821),r=t(8078),n=t(9544);let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});i.displayName="Card";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...r})});c.displayName="CardHeader";let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});l.displayName="CardTitle";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",t),...r})});d.displayName="CardContent"},9544:function(e,a,t){"use strict";t.d(a,{cn:function(){return cn}});var s=t(7683),r=t(188);function cn(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,s.W)(a))}}},function(e){e.O(0,[106,779,391,115,835,744],function(){return e(e.s=534)}),_N_E=e.O()}]);