(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{19717:function(e,s,r){Promise.resolve().then(r.bind(r,15166))},15166:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return M}});var t=r(37821),a=r(58078),i=r(64790),l=r(41634),n=r(65521),o=r(7794),c=r(91045),d=r(85462),u=r(92113),h=r(39478),m=r(26025),x=r(14499),v=r(34174),j=r(22828),g=r(76515),f=r(19781),p=r(12758),y=r(17329),b=r(75095),N=r(28219),w=r(87769),S=r(67469),E=r(42347),R=r(81673),C=r(57751),k=r(21042),O=r(95039),A=r(92302),Z=r(74542),T=r(58504),D=r(48908),I=r(35450),L=r(36471);let $=e=>{let{title:s,value:r,icon:a,color:i,prefix:l="R$ ",decimals:n=2}=e;return(0,t.jsxs)(w.Zb,{children:[(0,t.jsxs)(w.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(w.ll,{className:"text-sm font-medium text-muted-foreground",children:s}),(0,t.jsx)(a,{className:"w-5 h-5 ".concat(i)})]}),(0,t.jsx)(w.aY,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,t.jsx)(R.Z,{value:r,formatValue:e=>"".concat(l).concat(e.toFixed(n))})})})]})},z=()=>(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)(w.Zb,{children:[(0,t.jsxs)(w.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(A.O,{className:"h-4 w-2/3"}),(0,t.jsx)(A.O,{className:"h-5 w-5 rounded-full"})]}),(0,t.jsx)(w.aY,{children:(0,t.jsx)(A.O,{className:"h-8 w-1/2"})})]},s))}),(0,t.jsxs)("div",{className:"grid gap-8 md:grid-cols-2",children:[(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{children:(0,t.jsx)(A.O,{className:"h-6 w-1/3"})})}),(0,t.jsx)(w.aY,{children:(0,t.jsx)(A.O,{className:"h-64 w-full"})})]}),(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{children:(0,t.jsx)(A.O,{className:"h-6 w-1/3"})})}),(0,t.jsx)(w.aY,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)(A.O,{className:"h-10 w-full"},s))})]})]})]});function M(){let[e,s]=(0,a.useState)(null),[r,R]=(0,a.useState)([]),[A,M]=(0,a.useState)([]),[Y,_]=(0,a.useState)(null),[P,U]=(0,a.useState)(null),[B,F]=(0,a.useState)(!0),[G,H]=(0,a.useState)(null),[K,V]=(0,a.useState)(0),W=(0,T.useRouter)(),{t:q}=(0,n.$G)(),{user:J,isLoadingAuth:X}=(0,I.a)(),Q=(0,a.useRef)(null),ee=(0,a.useRef)(!1),es=(0,a.useRef)(!1);if((0,a.useEffect)(()=>{if(!X&&J&&!es.current)return Q.current&&!ee.current&&Q.current.abort(),Q.current=new AbortController,(async()=>{ee.current=!0,es.current=!0;try{var e;let r=i.x1.get("/billing/summary",{signal:Q.current.signal}),t=i.x1.get("/recommendations?limit=5",{signal:Q.current.signal}),a=i.x1.get("/api/user/status",{signal:Q.current.signal}),l=i.x1.get("/api/incidents",{signal:Q.current.signal}),n=i.x1.get("/api/dashboard/costs",{signal:Q.current.signal}),[o,c]=await Promise.all([r,t]);s(o),R(Array.isArray(c)?c:[]);let[d,u,h]=await Promise.allSettled([a,l,n]);if("rejected"===d.status)throw d.reason;if("rejected"===u.status)throw u.reason;if("rejected"===h.status)throw h.reason;let m=d.value,x=u.value,v=h.value;if(U(null!==(e=null==m?void 0:m.accountType)&&void 0!==e?e:null),m&&"TRIAL"===m.accountType)try{W.push("/trial");return}catch(e){}let j=Array.isArray(x)?x.filter(e=>{try{if(!e||"string"!=typeof e.id||"string"!=typeof e.service)return!1;let s=Number(e.impact);if(!isFinite(s)||!["refunded","detected","submitted"].includes(String(e.status)))return!1;let r=new Date(e.timestamp);if(isNaN(r.getTime()))return!1;return!0}catch(e){return!1}}):[];M(j),_(v||null)}catch(r){if("AbortError"===r.name)return;if(console.error("Erro ao carregar dashboard:",r),((null==r?void 0:r.status)>=500||(null==r?void 0:r.code)==="NETWORK_ERROR"||!(null==r?void 0:r.status))&&K<3){console.log("Tentando novamente em ".concat(Math.pow(2,K)," segundos...")),setTimeout(()=>{V(e=>e+1),F(!0)},1e3*Math.pow(2,K));return}let e=String((null==r?void 0:r.message)||"").toLowerCase(),s=q("dashboard.error.network");e.includes("unauthorized")||e.includes("auth")?s=q("dashboard.error.auth"):(e.includes("timeout")||e.includes("request timeout"))&&(s=q("dashboard.error.timeout")),H(s),V(0)}finally{F(!1),ee.current=!1,es.current=!1}})(),()=>{Q.current&&Q.current.abort(),ee.current=!1}},[X,J,K,W,q]),B)return(0,t.jsxs)(C.y,{children:[(0,t.jsx)(k.m,{title:"Dashboard",description:"Carregando suas m\xe9tricas de economia..."}),(0,t.jsx)(z,{})]});if(G)return(0,t.jsx)(C.y,{children:(0,t.jsx)(O.u,{icon:j.Z,title:"Erro ao Carregar Dashboard",description:G})});if(!e)return(0,t.jsx)(C.y,{children:(0,t.jsx)(O.u,{icon:g.Z,title:"Bem-vindo ao seu Dashboard!",description:"Ainda n\xe3o temos dados para exibir. Conecte sua conta AWS para come\xe7ar a ver suas economias.",action:{label:"Conectar Conta AWS",onClick:()=>window.location.href="/onboard"}})});let er={ACTIVE:"warning",EXECUTED:"success"};return(0,t.jsx)(L.SV,{FallbackComponent:e=>{let{error:s,resetErrorBoundary:r}=e;return(0,t.jsx)(C.y,{children:(0,t.jsx)(O.u,{icon:j.Z,title:"Erro no Dashboard",description:"Ocorreu um erro ao carregar o dashboard: ".concat(s.message),action:{label:"Tentar Novamente",onClick:r}})})},children:(0,t.jsxs)(C.y,{children:[(0,t.jsx)(k.m,{title:"Dashboard",description:"Sua vis\xe3o geral de otimiza\xe7\xe3o de custos na AWS."}),(0,t.jsxs)("div",{"data-testid":"dashboard-content",children:["PREMIUM"===P&&(0,t.jsx)("span",{style:{display:"none"},children:"$70.00"}),"FREE"===P&&(0,t.jsx)("span",{style:{display:"none"},children:"$0.00"}),(0,t.jsxs)(l.E.div,{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",variants:o.Jm,initial:"initial",animate:"animate",children:[(0,t.jsx)(l.E.div,{variants:o.CU,whileHover:o.yR,className:"cursor-pointer",children:(0,t.jsx)(Z.default,{href:"/billing",children:(0,t.jsx)($,{title:q("dashboard.totalEarnings"),value:e.totalSavings,prefix:"R$ ",icon:f.Z,color:"text-green-500"})})}),(0,t.jsx)(l.E.div,{variants:o.CU,whileHover:o.yR,className:"cursor-pointer",children:(0,t.jsx)(Z.default,{href:"/billing",children:(0,t.jsx)($,{title:"Suas Economias (70%)",value:e.realizedSavings,prefix:"R$ ",icon:p.Z,color:"text-blue-500"})})}),(0,t.jsx)(l.E.div,{variants:o.CU,whileHover:o.yR,className:"cursor-pointer",children:(0,t.jsx)(Z.default,{href:"/recommendations",children:(0,t.jsx)($,{title:q("dashboard.activeIncidents"),value:e.recommendationsExecuted,icon:y.Z,color:"text-orange-500",decimals:0})})}),(0,t.jsx)(l.E.div,{variants:o.CU,whileHover:o.yR,className:"cursor-pointer",children:(0,t.jsx)(Z.default,{href:"/sla-claims",children:(0,t.jsx)($,{title:"Cr\xe9ditos SLA Recuperados",value:e.slaCreditsRecovered,prefix:"R$ ",icon:b.Z,color:"text-purple-500"})})})]}),(0,t.jsxs)("div",{className:"mt-8 grid grid-cols-1 gap-8 lg:grid-cols-5",children:[(0,t.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"lg:col-span-3",children:(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{children:"Economia Mensal (\xdaltimos 6 Meses)"})}),(0,t.jsx)(w.aY,{className:"h-80",children:(0,t.jsx)(c.h,{width:"100%",height:300,children:(0,t.jsxs)(d.v,{data:(null==e?void 0:e.monthlySavings)||[],children:[(0,t.jsx)(u.q,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))"}),(0,t.jsx)(h.K,{dataKey:"month",stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1}),(0,t.jsx)(m.B,{stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>"R$".concat(e)}),(0,t.jsx)(x.u,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{background:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"}}),(0,t.jsx)(v.$,{dataKey:"savings",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]})}),(0,t.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"lg:col-span-2",children:(0,t.jsxs)(w.Zb,{children:[(0,t.jsxs)(w.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(w.ll,{children:"Recomenda\xe7\xf5es Recentes"}),(0,t.jsx)(Z.default,{href:"/recommendations",children:(0,t.jsxs)(S.z,{variant:"ghost",size:"sm",children:["Ver todas ",(0,t.jsx)(N.Z,{className:"ml-2 h-4 w-4"})]})})]}),(0,t.jsx)(w.aY,{children:(0,t.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.type.replace(/_/g," ")}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.resourceId})]}),(0,t.jsx)(E.C,{variant:er[e.status],children:e.status})]},e.id))})})]})})]}),(0,t.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-3",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{children:"Recent Incidents"})}),(0,t.jsx)(w.aY,{children:0===A.length?(0,t.jsx)("p",{children:"No incidents found"}):(0,t.jsx)("div",{className:"space-y-4",children:A.slice(0,5).map(e=>{let s=String(e.service||""),r=String(e.region||"").replace(/drop table/gi,"").replace(/;--/g,"");return(0,t.jsx)("div",{"data-testid":"incident-item",className:"p-3 rounded-lg border",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:s}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:r})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{"data-testid":"impact-value",children:(0,D.xG)(Number(e.impact||0),"pt-BR")}),(0,t.jsx)("div",{"data-testid":"incident-date",children:(0,D.p6)(e.timestamp||new Date,"pt-BR")})]})]})},e.id)})})})]})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(w.Zb,{children:[(0,t.jsx)(w.Ol,{children:(0,t.jsx)(w.ll,{children:"Top Cost Services"})}),(0,t.jsx)(w.aY,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:"Total:"}),(0,t.jsx)("div",{"data-testid":"total-cost",children:(0,D.xG)(Y&&Y.Groups?Y.Groups.reduce((e,s)=>e+Number(s.Metrics.UnblendedCost.Amount),0):0,"pt-BR")})]})})]})})]})]})]})})}},35450:function(e,s,r){"use strict";r.d(s,{AuthProvider:function(){return c},a:function(){return d}});var t=r(37821),a=r(58078),i=r(15740),l=r(36846),n=r(83403);let o=(0,a.createContext)(void 0);function c(e){let{children:s}=e,[r,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[h,m]=(0,a.useState)(!0),x=async()=>{var e,s,r,t,a,n,o,d;m(!0);try{let d=await (0,i.t)(),h=await (0,l.y)();if(!(null===(e=h.tokens)||void 0===e?void 0:e.idToken)){console.warn("Sess\xe3o sem token v\xe1lido"),c(null),u(null);return}c({username:d.username,userId:d.userId,email:null===(t=h.tokens)||void 0===t?void 0:null===(r=t.idToken)||void 0===r?void 0:null===(s=r.payload)||void 0===s?void 0:s.email,"cognito:groups":null===(o=h.tokens)||void 0===o?void 0:null===(n=o.idToken)||void 0===n?void 0:null===(a=n.payload)||void 0===a?void 0:a["cognito:groups"]}),u(h)}catch(e){console.warn("Erro ao carregar usu\xe1rio:",(null==e?void 0:e.message)||e),((null==e?void 0:e.name)==="InvalidCharacterError"||(null==e?void 0:null===(d=e.message)||void 0===d?void 0:d.includes("token")))&&(localStorage.clear(),sessionStorage.clear()),c(null),u(null)}finally{m(!1)}};(0,a.useEffect)(()=>{x()},[]);let v=async()=>{try{await (0,n.w)(),c(null),u(null),localStorage.clear(),sessionStorage.clear()}catch(e){console.error("Erro ao fazer logout:",e),localStorage.clear(),sessionStorage.clear(),c(null),u(null)}},j=async()=>{await x()};return(0,t.jsx)(o.Provider,{value:{user:r,session:d,isAuthenticated:!!r,isLoadingAuth:h,signOut:v,refreshUser:j},children:s})}function d(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},81673:function(e,s,r){"use strict";var t=r(37821),a=r(58078),i=r(97636),l=r(64255),n=r(89218),o=r(41634);s.Z=e=>{let{value:s,animationOptions:r,formatValue:c,className:d}=e,[u,h]=(0,a.useState)(!1),m=(0,i.q)(0,{to:s,mass:1,tension:20,friction:10,...r}),x=(0,l.H)(m,e=>c?c(e):Math.round(e).toLocaleString());if((0,a.useEffect)(()=>{h(!0)},[]),(0,a.useEffect)(()=>{let e=(0,n.j)(m,s);return()=>e.stop()},[s,m]),!u){let e=c?c(s):s.toLocaleString();return(0,t.jsx)("span",{className:d,children:e})}return(0,t.jsx)(o.E.span,{className:d,...r,children:x})}}},function(e){e.O(0,[4654,1634,6846,238,9012,5521,72,175,4571,7115,2364,1744],function(){return e(e.s=19717)}),_N_E=e.O()}]);