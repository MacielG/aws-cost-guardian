<!DOCTYPE html>
<html>
<head>
    <title>Test Cognito Token Groups</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Teste de Token Cognito - Groups</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg, className = '') {
            const div = document.createElement('div');
            div.className = className;
            div.textContent = msg;
            output.appendChild(div);
        }
        
        function logPre(title, obj) {
            const h3 = document.createElement('h3');
            h3.textContent = title;
            output.appendChild(h3);
            
            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(obj, null, 2);
            output.appendChild(pre);
        }
        
        async function testToken() {
            try {
                log('Obtendo sess√£o...', 'info');
                
                // Importar Amplify
                const { fetchAuthSession } = await import('https://cdn.jsdelivr.net/npm/aws-amplify@6/+esm');
                
                const session = await fetchAuthSession({ forceRefresh: true });
                
                if (!session || !session.tokens) {
                    log('‚ùå Sess√£o n√£o encontrada. Fa√ßa login primeiro.', 'error');
                    return;
                }
                
                log('‚úÖ Sess√£o obtida', 'success');
                
                // Access Token
                const accessToken = session.tokens.accessToken;
                if (accessToken) {
                    const payload = accessToken.payload;
                    logPre('üìÑ Access Token Payload:', payload);
                    
                    const groups = payload['cognito:groups'];
                    if (groups) {
                        log(`‚úÖ cognito:groups encontrado: ${JSON.stringify(groups)}`, 'success');
                        if (groups.includes('Admins')) {
                            log('‚úÖ Usu√°rio √â ADMIN!', 'success');
                        }
                    } else {
                        log('‚ùå cognito:groups N√ÉO est√° no Access Token', 'error');
                        log('', '');
                        log('Poss√≠veis causas:', 'info');
                        log('1. Usu√°rio n√£o est√° em nenhum grupo', '');
                        log('2. Token foi gerado antes do usu√°rio ser adicionado ao grupo', '');
                        log('3. App Client precisa de configura√ß√£o (improv√°vel se ReadAttributes=null)', '');
                        log('', '');
                        log('Solu√ß√£o:', 'info');
                        log('1. Fa√ßa logout e login novamente', '');
                        log('2. Ou force refresh: fetchAuthSession({ forceRefresh: true })', '');
                    }
                } else {
                    log('‚ùå Access Token n√£o dispon√≠vel', 'error');
                }
                
                // ID Token
                const idToken = session.tokens.idToken;
                if (idToken) {
                    const payload = idToken.payload;
                    logPre('üìÑ ID Token Payload:', payload);
                    
                    const groups = payload['cognito:groups'];
                    if (groups) {
                        log(`‚ÑπÔ∏è  cognito:groups tamb√©m est√° no ID Token: ${JSON.stringify(groups)}`, 'info');
                    }
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Execute automaticamente
        log('Iniciando teste...', 'info');
        log('', '');
        testToken();
    </script>
</body>
</html>
